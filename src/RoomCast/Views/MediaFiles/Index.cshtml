@model IEnumerable<RoomCast.Models.MediaFile>
@{
    ViewData["Title"] = "My Files";
}

<h2>My Files</h2>

<form method="get">
    <input type="text" name="searchTags" placeholder="Search by tags" />
    <button type="submit">Search</button>
</form>

@if (TempData["Message"] != null)
{
    <div class="alert alert-success">@TempData["Message"]</div>
}

<table class="table">
    <thead>
        <tr>
            <th>Title</th>
            <th>Type</th>
            <th>Size</th>
            <th>Uploaded</th>
            <th>Tags</th>
            <th>Preview</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var file in Model)
        {
            var uploadedAt = file.CreatedAt.ToLocalTime().ToString("g");
            var sizeInMb = file.FileSize / (1024d * 1024d);
            var duration = file.DurationSeconds.HasValue ? System.TimeSpan.FromSeconds(file.DurationSeconds.Value) : (System.TimeSpan?)null;
            var durationLabel = duration.HasValue
                ? (duration.Value.TotalHours >= 1
                    ? duration.Value.ToString(@"hh\:mm\:ss")
                    : duration.Value.ToString(@"mm\:ss"))
                : null;
            <tr>
                <td>@file.Title</td>
                <td>@file.FileType</td>
                <td>@string.Format("{0:0.##} MB", sizeInMb)</td>
                <td>@uploadedAt</td>
                <td>@file.Tags</td>
                <td>
                    @if (string.Equals(file.FileType, "Picture", System.StringComparison.OrdinalIgnoreCase) || string.Equals(file.FileType, "Image", System.StringComparison.OrdinalIgnoreCase))
                    {
                        <img src="@file.FilePath" alt="@file.Title" width="120" class="img-thumbnail" />
                    }
                    else if (string.Equals(file.FileType, "Video", System.StringComparison.OrdinalIgnoreCase))
                    {
                        if (!string.IsNullOrEmpty(file.ThumbnailPath))
                        {
                            <img src="@file.ThumbnailPath" alt="@file.Title" width="160" class="img-thumbnail" />
                        }
                        else
                        {
                            <video width="200" controls preload="metadata">
                                <source src="@file.FilePath" type="video/mp4" />
                            </video>
                        }
                        if (durationLabel != null)
                        {
                            <div class="small text-muted">Duration: @durationLabel</div>
                        }
                    }
                    else
                    {
                        <a href="@file.FilePath" target="_blank">Open</a>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>
